Using cuda device
2025-05-19 20:02:08,518 - root - INFO - Loaded ViT-B-32 model config.
2025-05-19 20:02:12,094 - root - INFO - Loading pretrained ViT-B-32 weights (laion2b_s34b_b79k).
2025-05-19 20:02:13,119 - root - INFO - Loaded ViT-B-32 model config.
2025-05-19 20:02:15,425 - root - INFO - Loading pretrained ViT-B-32 weights (laion2b_s34b_b79k).
Initial context: "X X X X X X X X"
Number of context words (tokens): 8
CLIP(
  (visual): VisionTransformer(
    (conv1): Conv2d(3, 768, kernel_size=(32, 32), stride=(32, 32), bias=False)
    (patch_dropout): Identity()
    (ln_pre): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
    (transformer): Transformer(
      (resblocks): ModuleList(
        (0-11): 12 x ResidualAttentionBlock(
          (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          (attn): MultiheadAttention(
            (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
          )
          (ls_1): Identity()
          (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          (mlp): Sequential(
            (c_fc): Linear(in_features=768, out_features=3072, bias=True)
            (gelu): GELU(approximate='none')
            (c_proj): Linear(in_features=3072, out_features=768, bias=True)
          )
          (ls_2): Identity()
        )
      )
    )
    (ln_post): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
  )
  (transformer): Transformer(
    (resblocks): ModuleList(
      (0-11): 12 x ResidualAttentionBlock(
        (ln_1): LayerNorm((512,), eps=1e-05, elementwise_affine=True)
        (attn): MultiheadAttention(
          (out_proj): NonDynamicallyQuantizableLinear(in_features=512, out_features=512, bias=True)
        )
        (ls_1): Identity()
        (ln_2): LayerNorm((512,), eps=1e-05, elementwise_affine=True)
        (mlp): Sequential(
          (c_fc): Linear(in_features=512, out_features=2048, bias=True)
          (gelu): GELU(approximate='none')
          (c_proj): Linear(in_features=2048, out_features=512, bias=True)
        )
        (ls_2): Identity()
      )
    )
  )
  (token_embedding): Embedding(49408, 512)
  (ln_final): LayerNorm((512,), eps=1e-05, elementwise_affine=True)
)
2025-05-19 20:02:15,979 - cocoop_training - INFO - Loading Flowers102 dataset from ./data
2025-05-19 20:02:16,243 - cocoop_training - INFO - Dataset loaded: 1020 train, 1020 val, 6149 test
2025-05-19 20:02:16,245 - cocoop_training - INFO - Using cuda device
2025-05-19 20:02:16,245 - root - INFO - Loaded ViT-B-32 model config.
2025-05-19 20:02:18,578 - root - INFO - Loading pretrained ViT-B-32 weights (laion2b_s34b_b79k).
2025-05-19 20:02:18,969 - cocoop_training - INFO - Loading Flowers102 dataset from ./data
2025-05-19 20:02:19,012 - cocoop_training - INFO - Dataset loaded: 1020 train, 1020 val, 6149 test
2025-05-19 20:02:19,013 - cocoop_training - INFO - Running initial zero-shot evaluation...
ðŸ§  Zero-shot evaluation on Base Classes: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 20/20 [01:00<00:00,  3.03s/it]
ðŸ§  Zero-shot evaluation on Novel Classes: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 29/29 [02:15<00:00,  4.68s/it]
2025-05-19 20:05:36,062 - cocoop_training - INFO - ==== Zero-shot Evaluation Results ====
2025-05-19 20:05:36,063 - cocoop_training - INFO - ðŸ” Base classes accuracy: 74.69%
2025-05-19 20:05:36,063 - cocoop_training - INFO - ðŸ” Novel classes accuracy: 77.04%
2025-05-19 20:05:36,063 - cocoop_training - INFO - ðŸ” Harmonic Mean: 75.85%
2025-05-19 20:05:36,063 - cocoop_training - INFO - Starting training...
2025-05-19 20:05:36,063 - cocoop_training - INFO - ==== Starting CoCoOp Training with HELIP ====
2025-05-19 20:05:36,063 - cocoop_training - INFO - Config: {'base_model': {'name': 'ViT-B-32', 'weights': 'laion2b_s34b_b79k'}, 'trainer': {'batch_size': 4, 'epochs': 3, 'lr': 0.002, 'weight_decay': 0.05, 'warmup_epochs': 1, 'patience': 5, 'checkpoint_dir': './checkpoints', 'cocoop': {'n_ctx': 8, 'ctx_init': '', 'prec': 'fp16'}}, 'input': {'size': [224, 224]}, 'data': {'data_dir': './data', 'num_workers': 0, 'pin_memory': False}, 'helip': {'enabled': True, 'k': 5, 'p': 20, 'alpha': 0.25, 'lambda_hnml': 0.5, 'mining_freq': 5, 'cache_embeddings': True}}
2025-05-19 20:05:36,065 - cocoop_training - INFO - Creating models...
2025-05-19 20:05:36,065 - root - INFO - Loaded ViT-B-32 model config.
2025-05-19 20:05:37,797 - root - INFO - Loading pretrained ViT-B-32 weights (laion2b_s34b_b79k).
2025-05-19 20:05:38,098 - root - INFO - Loaded ViT-B-32 model config.
2025-05-19 20:05:40,206 - root - INFO - Loading pretrained ViT-B-32 weights (laion2b_s34b_b79k).
Initial context: "X X X X X X X X"
Number of context words (tokens): 8
2025-05-19 20:05:40,401 - cocoop_training - INFO - Loading datasets...
2025-05-19 20:05:40,402 - cocoop_training - INFO - Loading Flowers102 dataset from ./data
2025-05-19 20:05:40,417 - cocoop_training - INFO - Dataset loaded: 1020 train, 1020 val, 6149 test
2025-05-19 20:05:40,420 - cocoop_training - INFO - Creating dataloaders...
2025-05-19 20:05:40,420 - cocoop_training - INFO - Created dataloaders with batch size 4
2025-05-19 20:05:40,420 - cocoop_training - INFO - Setting up optimizer and scheduler...
2025-05-19 20:05:40,421 - cocoop_training - INFO - HELIP is enabled for training
2025-05-19 20:05:40,422 - cocoop_training - WARNING - FAISS not available. Falling back to brute force search
2025-05-19 20:05:40,422 - cocoop_training - INFO - Evaluating zero-shot performance of base model...
Epoch 0 - Base Classes: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 20/20 [01:59<00:00,  5.96s/it]
Epoch 0 - Novel Classes: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 29/29 [02:54<00:00,  6.01s/it]
2025-05-19 20:10:36,153 - cocoop_training - INFO - Epoch 0 - Base Accuracy: 0.7469, Novel Accuracy: 0.7704, Harmonic Mean: 0.7585
2025-05-19 20:10:36,153 - cocoop_training - INFO - Zero-shot: Base Acc=0.7469, Novel Acc=0.7704, HM=0.7585
2025-05-19 20:10:36,154 - cocoop_training - INFO - Starting training...
2025-05-19 20:10:36,154 - cocoop_training - ERROR - Error during training: train_loop() got an unexpected keyword argument 'use_helip'
2025-05-19 20:10:36,781 - cocoop_training - INFO - Saved checkpoint at ./checkpoints/checkpoint_epoch_1.pth
2025-05-19 20:10:36,782 - cocoop_training - ERROR - Error in main execution: train_loop() got an unexpected keyword argument 'use_helip'
2025-05-19 20:10:36,782 - cocoop_training - INFO - Finishing wandb run...
